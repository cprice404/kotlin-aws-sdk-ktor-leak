#!/usr/bin/env bash

set -e
set -x
set -o pipefail

/Users/cprice/.sdkman/candidates/java/17.0.1-open/bin/java \
    -Dfile.encoding=UTF-8 \
    -Duser.country=US \
    -Duser.language=en \
    -Duser.variant \
    -Xms400m \
    -Xmx400m \
    -agentpath:/Applications/YourKit-Java-Profiler-2022.3.app/Contents/Resources/bin/mac/libyjpagent.dylib=disablestacktelemetry,exceptions=disable,delay=10000 \
    -cp /Users/cprice/git/momento/kotlin-aws-sdk-ktor-leak/app/build/classes/java/main:/Users/cprice/git/momento/kotlin-aws-sdk-ktor-leak/app/build/classes/kotlin/main:/Users/cprice/git/momento/kotlin-aws-sdk-ktor-leak/app/build/resources/main:/Users/cprice/.gradle/caches/modules-2/files-2.1/aws.sdk.kotlin/sqs/0.14.1-beta/318cc41cc0fd3056d8d74466ab54f5f9f0de17c4/sqs-0.14.1-beta.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/aws.sdk.kotlin/aws-config-jvm/0.14.1-beta/68f2b150cda29d9918b99fdc921de8c2738f18e4/aws-config-jvm-0.14.1-beta.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/aws.smithy.kotlin/http-client-engine-default-jvm/0.8.1/2b3eba80ed423f84caf2571b96238713557bdead/http-client-engine-default-jvm-0.8.1.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/io.ktor/ktor-client-okhttp/1.6.7/f3988a9cd0bf919597775be676adaa208db7e643/ktor-client-okhttp-jvm-1.6.7.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/aws.sdk.kotlin/aws-xml-protocols-jvm/0.14.1-beta/d6989d319cd89462a020e149a5373828d51bf4f2/aws-xml-protocols-jvm-0.14.1-beta.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/aws.sdk.kotlin/aws-json-protocols-jvm/0.14.1-beta/f169d4a15035b07c76ea73ff6fdc973d6e84ec7/aws-json-protocols-jvm-0.14.1-beta.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/aws.sdk.kotlin/aws-http-jvm/0.14.1-beta/2be888e25519c4dfb4344465316da5a3b07285ae/aws-http-jvm-0.14.1-beta.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/aws.sdk.kotlin/aws-signing-jvm/0.14.1-beta/48f91108c9d8fc9d3a62202f6d10678a0af8899a/aws-signing-jvm-0.14.1-beta.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/aws.sdk.kotlin/aws-endpoint-jvm/0.14.1-beta/c3e1067d4d7d704488d77119a2b67e25540926dc/aws-endpoint-jvm-0.14.1-beta.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/aws.smithy.kotlin/http-client-engine-ktor-jvm/0.8.1/fbc84058fc8db9a782be9e58329a7c14aef5fd39/http-client-engine-ktor-jvm-0.8.1.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/aws.smithy.kotlin/crt-util-jvm/0.8.1/9e92390192f8e5e1979051b44a08bfebb53cec7/crt-util-jvm-0.8.1.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/aws.smithy.kotlin/http-jvm/0.8.1/7b5c8f7c8414c3c9fe8403c8282d18edef89ed99/http-jvm-0.8.1.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/aws.smithy.kotlin/serde-form-url-jvm/0.8.1/9d5552c295649a72cfc1841b79eb87e9f5ccca8e/serde-form-url-jvm-0.8.1.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/aws.smithy.kotlin/serde-xml-jvm/0.8.1/f3e7bc09e510fb949dfb928f4ac4be03f8926160/serde-xml-jvm-0.8.1.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/aws.smithy.kotlin/serde-json-jvm/0.8.1/6edf48bd9ef5ea8b0a6881f644058214251717c9/serde-json-jvm-0.8.1.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/aws.smithy.kotlin/serde-jvm/0.8.1/440cf2ecbf2927440421bf51fc773667b121fe22/serde-jvm-0.8.1.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/aws.sdk.kotlin/aws-core-jvm/0.14.1-beta/6c2ee4d8ac163be387e3eb83da863c6adb1269fd/aws-core-jvm-0.14.1-beta.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/aws.sdk.kotlin/aws-types-jvm/0.14.1-beta/be7f74cbf3cb416c17c3ca291c7bbe8626505e4b/aws-types-jvm-0.14.1-beta.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/aws.smithy.kotlin/runtime-core-jvm/0.8.1/854fb72ce7cbf36f5808d45614fbae34affdceac/runtime-core-jvm-0.8.1.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/aws.smithy.kotlin/io-jvm/0.8.1/c1b813fc00e3328ad629d1d0378ba3efe55c175c/io-jvm-0.8.1.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/aws.smithy.kotlin/logging-jvm/0.8.1/e0d1c2c6ec6796093d4cc0f3cb11724fdb4d1cb1/logging-jvm-0.8.1.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/aws.smithy.kotlin/utils-jvm/0.8.1/d61b643b5485808d1cbb2b6aa7fc91f9c72ecb7d/utils-jvm-0.8.1.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/io.ktor/ktor-client-core-jvm/1.6.7/6732da42e91ee8d51abfc1d4113606956f1dd7/ktor-client-core-jvm-1.6.7.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/io.ktor/ktor-http-cio-jvm/1.6.7/7fb3f35841398d7bcf95a8917c7e4ebb7bef61e3/ktor-http-cio-jvm-1.6.7.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/io.ktor/ktor-http-jvm/1.6.7/eb564a2a40e64d786d914a989759abd8c553e419/ktor-http-jvm-1.6.7.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/io.ktor/ktor-network-jvm/1.6.7/d59262677cab11f50be579a468e3bfe34efd0b80/ktor-network-jvm-1.6.7.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/io.ktor/ktor-utils-jvm/1.6.7/b746be94f9ed4ceac132930e84a41059d9490d9f/ktor-utils-jvm-1.6.7.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/io.ktor/ktor-io-jvm/1.6.7/375001bb92e11a788f93a58523ed73d9a0774e02/ktor-io-jvm-1.6.7.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/aws.sdk.kotlin.crt/aws-crt-kotlin-jvm/0.5.4/f9f9d614af6871a076fdab62cec030ba6175303/aws-crt-kotlin-jvm-0.5.4.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlinx/kotlinx-coroutines-jdk8/1.6.0/49fdbe0570870f025f293c25f5e58fdf5be8dafb/kotlinx-coroutines-jdk8-1.6.0.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlinx/kotlinx-coroutines-core-jvm/1.6.0/f3b8fd26c2e76d2f18cbc36aacb6e349fcb9fd5f/kotlinx-coroutines-core-jvm-1.6.0.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlin/kotlin-stdlib-jdk8/1.6.10/e80fe6ac3c3573a80305f5ec43f86b829e8ab53d/kotlin-stdlib-jdk8-1.6.10.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlin/kotlin-stdlib-jdk7/1.6.10/e1c380673654a089c4f0c9f83d0ddfdc1efdb498/kotlin-stdlib-jdk7-1.6.10.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlinx/atomicfu-jvm/0.17.0/d3d2e380b6ee28231118101d09ae6dd06a1db1cb/atomicfu-jvm-0.17.0.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/com.squareup.okhttp3/okhttp/4.9.2/5302714ee9320b64cf65ed865e5f65981ef9ba46/okhttp-4.9.2.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/com.squareup.okio/okio/2.8.0/49b64e09d81c0cc84b267edd0c2fd7df5a64c78c/okio-jvm-2.8.0.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/io.github.microutils/kotlin-logging-jvm/2.0.3/acd404001442be5d98fbaa7ff9df83041cba70fe/kotlin-logging-jvm-2.0.3.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlin/kotlin-stdlib/1.6.10/b8af3fe6f1ca88526914929add63cf5e7c5049af/kotlin-stdlib-1.6.10.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/org.jetbrains.kotlin/kotlin-stdlib-common/1.6.10/c118700e3a33c8a0d9adc920e9dec0831171925/kotlin-stdlib-common-1.6.10.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/org.jetbrains/annotations/13.0/919f0dfe192fb4e063e7dacadee7f8bb9a2672a9/annotations-13.0.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/org.slf4j/slf4j-api/1.7.32/cdcff33940d9f2de763bc41ea05a0be5941176c3/slf4j-api-1.7.32.jar:/Users/cprice/.gradle/caches/modules-2/files-2.1/software.amazon.awssdk.crt/aws-crt/0.15.18/892ffc004a1e81c08f834447d444a140f22a2174/aws-crt-0.15.18.jar \
    cprice.kotlin_aws_sdk.ktor.leak.AppKt
